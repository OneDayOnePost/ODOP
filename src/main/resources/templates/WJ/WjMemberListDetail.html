<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <title>ODOP</title>

    <!--Bootstrap 용 CSS-->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">

    <!--Bootstrap 용 Icon CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <!--font awesome 용-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!--google fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">

    <!--CSS-->
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <link th:href="@{/css/footer.css}" rel="stylesheet">

    <!--thymeleaf contextpath-->
    <link id="contextPathHolder" th:data-contextPath="${#httpServletRequest.getContextPath()}" />
    
    <!--jQuery 추가-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

    <style>
        html,
        body {
            height: 100%;
        }

        body {
            overflow-x:hidden;
        }

        #body-wrapper {
            position: relative;
            min-height: 100vh;
            padding-bottom: 230px;
        }

        footer {
            height: 230px;
            position: relative;
            transform: translateY(-100%);
        }

        /* --------------------------------------------------------------------------- */

        #member_list a:hover i,
        #member_list a:hover span {
            text-decoration: none;
            color: #B6C6D3;
            cursor: pointer;
        }

        #member_list a {
            text-decoration: none; 
            color: black; 
            display: inline-block; 
            vertical-align: middle;
        }

        #member_list a i {
            font-size: 21px; 
            vertical-align: middle;
        }

        #member_list a span {
            color: black; 
            display: inline-block; 
            line-height: 20px; 
            vertical-align: middle;
        }

        /* --------------------------------------------------------------------------- */

        /* 정보 윗부분 (프로필사진, 블로그명, 블로그 소개) */
        #member_info_top {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }

        #info_top {
            width: 85%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 왼쪽 영역 */
        #left-area {
            width: 25%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 중간 영역 */
        #middle-area {
            width: 9%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #middle-area hr {
            height: 75%;
            width:2px;
            border-width:0;
            color:#000;
            background-color:#000;
        }

        /* 오른쪽 영역 */
        #right-area {
            width: 63%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .blogname {
            width: 100%;
            height: 100%;
            padding-left: 15px;
            margin-top: 0px;
            margin-bottom: 0px;
            display: flex;
            align-items: end;
        }

        .introduce {
            width: 100%;
            height: 100%;
            padding-left: 15px;
            margin-top: 0px;
            margin-bottom: 0px;
        }

        /* --------------------------------------------------------------------------- */

        /* 정보 아래부분 (이메일, 이름, 연락처, 닉네임, MBTI, 가입일, 회원 상태) */
        #member_info_bottom {
            margin: 0 auto;
            margin-top: 40px;
            width: 70%;
        }

        .info {
            float: left;
            padding-left: 10px;
        }

        .homeline {
            border-top: 2.4px solid #A2B2CD;
            margin-top: 15px;
        }

        .endline {
            border-top: 2.4px solid #A2B2CD;
        }

        #info_table{
            width: 100%;        
        }

        .tableline{
            border-bottom: 1.5px solid #9ea5b2;
        }

        #info_table th{
            padding-left: 120px;
            padding-top: 30px;
            padding-bottom: 30px;
        }

        #info_table td{
            padding-top: 30px;
            padding-bottom: 30px;
        }

        .table_left {
            display: flex;
            align-content: flex-end;
            flex-direction: row;
            margin-left: 90px;
            align-items: center;
        }

        /* --------------------------------------------------------------------------- */

        /* 신고 게시글&댓글 개수 테이블 */
        #member_reporttable {
            margin: 0 auto;
            margin-top: 80px;
            width: 70%;
        }

        #reporttable {
            width: 100%;
            text-align: center;
        }

        #reporttable thead tr th{
            padding-top: 25px;
            padding-bottom: 25px;
            width: 25%;
        }

        #reporttable tbody tr td{
            padding-top: 25px;
            padding-bottom: 25px;
            width: 25%;
        }

        .right_line {
            border-right: 1.5px solid #9ea5b2;
        }

        /* --------------------------------------------------------------------------- */

        /* 블랙리스트 등록 버튼 */
        #update_to_blacklist {
            border-radius: 30px;
            background-color: #FF5555;
            color: #ffffff;
            border: none;
            width: 150px;
            height: 40px;
        }

        /* 블랙리스트 등록 취소 버튼 */
        #update_to_graylist {
            border-radius: 30px;
            background-color: #FF5555;
            color: #ffffff;
            border: none;
            width: 180px;
            height: 40px;
        }

        /* --------------------------------------------------------------------------- */

        .scroll-buttons {
            position: fixed;
            bottom: 50px;
            right: 50px;
            display: flex;
        }

        .scroll-button {
            font-size: 40px;
            margin-left: 10px;
            display: none;
        }

        #scrolldown {
            display: none;
        }

        #scrollup {
            display: none;
        }

        #scrolldown:hover,
        #scrollup:hover {
            cursor: pointer;
        }
    </style>

</head>

<body>
    <!--wrapper 영역-->
    <div id="body-wrapper">
        <!-- header 영역 -->
        <div th:replace="~{fragments/header :: header}"></div>

        <!-- 본문 영역 -->
        <div id="wrapper" class="container" style="display: flex; justify-content: center; align-items: center; margin-top: 40px; margin-bottom: 60px;">
            <div th:each="member : ${memberone}" id="body_content" style="width: 90%;">
                <div id="member_list" style="text-align: right;">
                    <a th:href="@{/adminhome.do(type=memberlist, menu=${menu})}">
                        <i class="bi bi-list"></i>
                        <span th:if="${menu} eq 'all'">전체 회원 목록</span>
                        <span th:if="${menu} eq 'graylist'">블랙리스트 대기</span>
                        <span th:if="${menu} eq 'general'">일반 회원</span>
                        <span th:if="${menu} eq 'blacklist'">블랙리스트 회원</span>
                        <span th:if="${menu} eq 'leave'">탈퇴한 회원</span>
                    </a>
                </div>

                <div id="member_info_top">
                    <div id="info_top">
                        <div id="left-area">
                            <img th:src="${member.imgpath}" th:key="${member.imgkey}" style="border-radius: 50%; width: 170px; height: 170px;"
                                 onerror="this.src='images/default_thumbnail.png'">
                        </div>
        
                        <div id="middle-area">
                            <hr />
                        </div>
        
                        <div id="right-area">
                            <div style="width: 95%; height: 18%; display: flex; margin-bottom: 5px; align-items: end;">
                                <p style="width: 16%; font-weight: bold; margin-bottom: 0px;">블로그명</p>
                                <p class="blogname" th:text="${member.blogname}"></p>
                            </div>

                            <div style="width: 95%; height: 15%; display: flex; align-items: center;">
                                <hr style="width: 100%; margin: 0; border-width: 2px; color: #000; background-color: #000;">
                            </div>

                            <div style="width: 95%; height: 36%; display: flex; margin-top: 5px;">
                                <p style="width: 16%; font-weight: bold; margin-bottom: 0px;">소개</p>
                                <p class="introduce" th:text="${member.introduce}"></p>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div id="member_info_bottom">
                    <h3 class="info">회원 정보</h3>
                    <br/>
                    <div class="homeline"></div>
                    <table id="info_table">
                        <tr class="tableline">
                            <th>이메일</th>
                            <td th:text="${member.email}" class="table_left" id="email"></td>
                        </tr>

                        <tr class="tableline">
                            <th>이름</th>
                            <td th:text="${member.name}" class="table_left"></td>
                        </tr>

                        <tr class="tableline">
                            <th>연락처</th>
                            <td th:text="${member.phone}" class="table_left"></td>
                        </tr>

                        <tr class="tableline">
                            <th>닉네임</th>
                            <td th:text="${member.nickname}" class="table_left"></td>
                        </tr>

                        <tr class="tableline">
                            <th>MBTI</th>
                            <td th:text="${member.mbti}" class="table_left"></td>
                        </tr>

                        <tr class="tableline">
                            <th>가입일</th>
                            <td th:text="${#dates.format(member.regdate, 'yyyy년 MM월 dd일 hh시 mm분')}" class="table_left"></td>
                        </tr>

                        <tr>
                            <th>회원 등급</th>
                            <td class="table_left">
                                <span th:text="${member.quitchk == -1 ? '블랙리스트' : (member.quitchk == 0 ? (postdeletecount + replydeletecount > 0 ? '블랙리스트 대기' : '일반 회원') : (member.quitchk == 1 ? '탈퇴' : ''))}"></span>
                            </td>
                        </tr>
                    </table>
                    <div class="endline"></div>
                </div>

                <div id="member_reporttable">
                    <h3 class="info">게시글 및 댓글 정보</h3>
                    <br/>
                    <div class="homeline"></div>
                    <table id="reporttable">
                        <thead>
                            <tr class="tableline">
                                <th class="right_line">작성한 게시글</th>
                                <th class="right_line">관리자 삭제된<br/>게시글</th>
                                <th class="right_line">작성한 댓글</th>
                                <th>관리자 삭제된<br/>댓글</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="tableline">
                                <td th:text="${postcount}" class="right_line"></td>
                                <td th:text="${postdeletecount}" class="right_line"></td>
                                <td th:text="${replycount}" class="right_line"></td>
                                <td th:text="${replydeletecount}"></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="font-weight: bold;" class="right_line">관리자 삭제된<br/>게시글과 댓글 총합</td>
                                <td colspan="2" th:text="${postdeletecount + replydeletecount}"></td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="endline"></div>
                </div>

                <div th:if="${member.quitchk == 0 && (postdeletecount + replydeletecount) >= 1}" style="display: flex; justify-content: center; align-items: center; margin-top: 30px;">
                    <button type="button" id="update_to_blacklist" data-bs-toggle="modal" data-bs-target="#blacklist_confirm">블랙리스트 등록</button>
                </div>

                <div th:if="${member.quitchk == -1}" style="display: flex; justify-content: center; align-items: center; margin-top: 30px;">
                    <button type="button" id="update_to_graylist" data-bs-toggle="modal" data-bs-target="#graylist_confirm">블랙리스트 등록 취소</button>
                </div>
            </div>
            
            <div class="scroll-buttons" style="z-index: 100;">
                <!-- 신고 테이블로 가는 버튼 -->
                <div id="scrolldown" class="scroll-button">
                    <i class="bi bi-arrow-down-circle"></i>
                </div>
                
                <!-- 화면 맨 위로 가는 버튼 -->
                <div id="scrollup" class="scroll-button">
                    <i class="bi bi-arrow-up-circle"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- footer 영역 -->
    <th:block th:replace="~{/fragments/footer :: footerHTML}"></th:block>

    <!-- 블랙리스트 등록 버튼 - confirm 창  -->
    <div class="modal fade" id="blacklist_confirm" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="text-align: center; font-weight: bold; color: gray; font-size: 19px; margin-top: 40px; margin-bottom: 40px;">블랙리스트로 등록하시겠습니까?</p>

                    <div style="display: flex; justify-content: center;">
                        <button type="button" class="btn" onclick="updateBlacklist()" 
                            style="background-color: #FF5555; color: white; margin-right: 10px; width: 80px; border-radius: 20px;">O</button>
                        <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background-color: #949494; color: white; margin-left: 10px; width: 80px; border-radius: 20px;">X</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 블랙리스트 등록 버튼 - 등록 후 alert 창  -->
    <div class="modal fade" id="blacklist_alert" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="text-align: center; font-weight: bold; color: gray; font-size: 19px; margin-top: 40px; margin-bottom: 40px;">등록되었습니다.</p>

                    <div style="display: flex; justify-content: center;">
                        <button type="button" class="btn" onclick="updateBlacklistOk()" 
                            style="background-color: #949494; color: white; width: 80px; border-radius: 20px;">확인</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 블랙리스트 등록 취소 버튼 - confirm 창  -->
    <div class="modal fade" id="graylist_confirm" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="text-align: center; font-weight: bold; color: gray; font-size: 19px; margin-top: 40px; margin-bottom: 40px;">블랙리스트 등록을 취소하시겠습니까?</p>

                    <div style="display: flex; justify-content: center;">
                        <button type="button" class="btn" onclick="updateGraylist()" 
                            style="background-color: #FF5555; color: white; margin-right: 10px; width: 80px; border-radius: 20px;">O</button>
                        <button type="button" class="btn" data-bs-dismiss="modal" 
                            style="background-color: #949494; color: white; margin-left: 10px; width: 80px; border-radius: 20px;">X</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 블랙리스트 등록 취소 버튼 - 등록 후 alert 창  -->
    <div class="modal fade" id="graylist_alert" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <p style="text-align: center; font-weight: bold; color: gray; font-size: 19px; margin-top: 40px; margin-bottom: 40px;">취소되었습니다.</p>

                    <div style="display: flex; justify-content: center;">
                        <button type="button" class="btn" onclick="updateGraylistOk()" 
                            style="background-color: #949494; color: white; width: 80px; border-radius: 20px;">확인</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.5/axios.min.js"></script>

    <script>
        const scrolldown = document.getElementById("scrolldown");
        const scrollup = document.getElementById("scrollup");

        // 스크롤바가 있는지 여부를 확인하는 함수
        function hasScrollbar() {
            return document.documentElement.scrollHeight > window.innerHeight;
        }

        // 스크롤바가 있을 경우 scrolldown 버튼을 보이도록 처리
        if (hasScrollbar()) {
            scrolldown.style.display = "block";
        }

        // Down(↓) 버튼을 클릭하면 페이지가 reporttable로 스크롤
        scrolldown.addEventListener("click", function () {
            const member_reporttable = document.getElementById("member_reporttable");
            const member_reporttablePosition = member_reporttable.offsetTop;

            window.scrollTo({ top: member_reporttablePosition, behavior: "smooth" });
        });

        window.addEventListener("scroll", function () {
            const currentScroll = window.pageYOffset;

            if (currentScroll > 0) {
                scrolldown.style.display = "none";
                scrollup.style.display = "block";
            } else {
                scrolldown.style.display = "block";
                scrollup.style.display = "none";
            }
        });

        // Top(↑) 버튼을 클릭하면 페이지가 맨 위로 스크롤
        scrollup.addEventListener("click", function () {
            window.scrollTo({ top: 0, behavior: "smooth" });
        });
    </script>

    <script th:inline="javascript" type="text/javascript">
        // 블랙리스트 등록 버튼
        // (1) confirm 
        async function updateBlacklist() {
            const email = document.getElementById('email').textContent;

            // rest api 호출
            const url = [[@{/api/admin/updateblacklist.json}]];
            const headers = {"Content-Type":"application/json"};
            const body = {"email":email};
            const { data } = await axios.put(url, body, { headers });

            // console.log(data);

            if (data.status === 200) {
                // 등록 confirm 모달창 닫기
                const blacklist_confirm = new bootstrap.Modal(document.getElementById('blacklist_confirm'));
                blacklist_confirm.hide();

                // 등록 alert 모달창 열기
                const blacklist_alert = new bootstrap.Modal(document.getElementById('blacklist_alert'));
                blacklist_alert.show();
            }
        }
        // (2) alert
        function updateBlacklistOk() {
            // 등록 alert 모달창 닫기
            const blacklist_alert = new bootstrap.Modal(document.getElementById('blacklist_alert'));
            blacklist_alert.hide();

            const email = document.getElementById('email').textContent;

            // 주소 이동
            if ([[${menu}]] == 'all') { // 전체 회원 목록 -> 전체 회원 목록 - 해당 회원 이메일
                window.location.href = [[@{/memberlist.do(menu='all')}]] + '&email=' + email;
            }
            else { // 블랙리스트 회원 페이지 - 해당 회원 이메일
                window.location.href = [[@{/memberlist.do(menu='blacklist')}]] + '&email=' + email;
            }
        }

        // 블랙리스트 등록 취소 버튼
        // (1) confirm 
        async function updateGraylist() {
            const email = document.getElementById('email').textContent;

            // rest api 호출
            const url = [[@{/api/admin/updategraylist.json}]];
            const headers = {"Content-Type":"application/json"};
            const body = {email:email};
            const { data } = await axios.put(url, body, { headers });

            // console.log(data);

            if (data.status === 200) {
                // 취소 confirm 모달창 닫기
                const graylist_confirm = new bootstrap.Modal(document.getElementById('graylist_confirm'));
                graylist_confirm.hide();

                // 취소 alert 모달창 열기
                const graylist_alert = new bootstrap.Modal(document.getElementById('graylist_alert'));
                graylist_alert.show();
            }
        }
        // (2) alert
        function updateGraylistOk() {
            // 취소 alert 모달창 닫기
            const graylist_alert = new bootstrap.Modal(document.getElementById('graylist_alert'));
            graylist_alert.hide();

            const email = document.getElementById('email').textContent;

            // 주소 이동
            if ([[${menu}]] == 'all') { // 전체 회원 목록 -> 전체 회원 목록 - 해당 회원 이메일
                window.location.href = [[@{/memberlist.do(menu='all')}]] + '&email=' + email;
            }
            else { // 블랙리스트 대기 페이지 - 해당 회원 이메일
                window.location.href = [[@{/memberlist.do(menu='graylist')}]] + '&email=' + email;
            }
        }
    </script>
</body>

</html>